<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Flarize â€“ Partner Dashboard</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='24' font-size='24'>âš¡</text></svg>">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{
  --bg:#F7F8FB;--bg2:#FFFFFF;--bg3:#F1F3F7;--glass:rgba(255,255,255,0.85);
  --border:#E5E7EB;--border2:#D1D5DB;
  --t1:#111827;--t2:#4B5563;--t3:#9CA3AF;
  --brand:#1E3A5F;--brand2:#2C5282;
  --green:#059669;--green-bg:rgba(5,150,105,0.08);
  --red:#DC2626;--red-bg:rgba(220,38,38,0.08);
  --amber:#D97706;--amber-bg:rgba(217,119,6,0.08);
  --accent:#E8A838;
  --r:12px;
}
html{scroll-behavior:smooth}
body{font-family:'DM Sans',system-ui,sans-serif;background:var(--bg);color:var(--t1);min-height:100vh;-webkit-font-smoothing:antialiased}

/* ===== LOGIN ===== */
.login-wrap{min-height:100vh;display:grid;place-items:center;padding:20px;background:linear-gradient(160deg,#0B1929 0%,#1E3A5F 50%,#2C5282 100%);position:relative;overflow:hidden}
.login-bg{position:absolute;inset:0;background:radial-gradient(ellipse at 30% 20%,rgba(232,168,56,0.12) 0%,transparent 50%),radial-gradient(ellipse at 70% 80%,rgba(59,130,246,0.08) 0%,transparent 50%)}
.login-box{background:#fff;border:1px solid #E5E7EB;border-radius:20px;padding:40px 32px;width:100%;max-width:380px;text-align:center;position:relative;z-index:1;animation:loginIn .6s ease;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
@keyframes loginIn{from{opacity:0;transform:translateY(24px) scale(0.96)}to{opacity:1;transform:translateY(0) scale(1)}}
.login-logo{font-size:20px;font-weight:800;color:#1E3A5F;margin-bottom:2px;letter-spacing:-0.5px}
.login-logo span{color:var(--accent)}
.login-sub{font-size:12px;color:#9CA3AF;margin-bottom:28px;text-transform:uppercase;letter-spacing:1.5px;font-weight:600}
.login-fld{text-align:left;margin-bottom:14px}
.login-fld label{display:block;font-size:11px;font-weight:700;color:#4B5563;margin-bottom:6px;text-transform:uppercase;letter-spacing:0.8px}
.login-fld input{width:100%;padding:12px 14px;background:#F7F8FB;border:1px solid #E5E7EB;border-radius:10px;color:#111827;font-size:14px;font-family:'DM Sans',sans-serif;outline:none;transition:all .2s}
.login-fld input:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(30,58,95,0.1)}
.login-fld input::placeholder{color:#9CA3AF}
.login-btn{width:100%;padding:13px;margin-top:4px;background:linear-gradient(135deg,#1E3A5F,#2C5282);color:#fff;border:none;border-radius:10px;font-size:14px;font-weight:700;cursor:pointer;font-family:'DM Sans',sans-serif;transition:all .2s;box-shadow:0 4px 16px rgba(30,58,95,0.25)}
.login-btn:hover{transform:translateY(-2px);box-shadow:0 6px 24px rgba(30,58,95,0.35)}
.login-err{color:var(--red);font-size:12px;margin-top:10px;display:none;font-weight:600}

/* ===== TOPBAR ===== */
.topbar{background:#fff;border-bottom:1px solid var(--border);padding:0 24px;height:56px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:0 1px 3px rgba(0,0,0,0.04)}
.topbar-left{display:flex;align-items:center;gap:12px}
.topbar-logo{font-size:15px;font-weight:800;letter-spacing:-0.3px;color:#1E3A5F}.topbar-logo span{color:var(--accent)}
.topbar-badge{font-size:9px;font-weight:700;background:var(--brand);color:#fff;padding:2px 8px;border-radius:6px;text-transform:uppercase;letter-spacing:0.5px}
.topbar-right{display:flex;gap:8px;align-items:center}
.tb-btn{background:var(--bg3);border:1px solid var(--border);color:var(--t2);padding:7px 14px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;font-family:'DM Sans',sans-serif;transition:.15s;display:flex;align-items:center;gap:5px}
.tb-btn:hover{background:var(--border);color:var(--t1)}
.tb-btn svg{width:14px;height:14px}
.tb-btn.logout{border-color:rgba(220,38,38,0.2);color:var(--red)}
.tb-btn.logout:hover{background:var(--red-bg)}

/* ===== STAT CARDS ===== */
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:20px}
.stat{background:#fff;border:1px solid var(--border);border-radius:var(--r);padding:18px 20px;position:relative;overflow:hidden;transition:all .2s;box-shadow:0 1px 3px rgba(0,0,0,0.03)}
.stat:hover{border-color:var(--border2);transform:translateY(-2px);box-shadow:0 4px 12px rgba(0,0,0,0.06)}
.stat::after{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.stat:nth-child(1)::after{background:var(--brand)}.stat:nth-child(2)::after{background:var(--amber)}.stat:nth-child(3)::after{background:var(--green)}.stat:nth-child(4)::after{background:var(--red)}
.stat-label{font-size:11px;font-weight:600;color:var(--t3);text-transform:uppercase;letter-spacing:0.8px;margin-bottom:6px}
.stat-val{font-size:28px;font-weight:800;font-family:'JetBrains Mono',monospace;letter-spacing:-1px}
.stat:nth-child(1) .stat-val{color:var(--brand)}.stat:nth-child(2) .stat-val{color:var(--amber)}.stat:nth-child(3) .stat-val{color:var(--green)}.stat:nth-child(4) .stat-val{color:var(--red)}

/* ===== FILTERS ===== */
.bar{display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;align-items:center}
.ftab{padding:7px 14px;border-radius:8px;font-size:12px;font-weight:600;cursor:pointer;border:1px solid var(--border);background:transparent;color:var(--t2);transition:.15s;display:flex;align-items:center;gap:5px}
.ftab:hover{border-color:var(--border2);color:var(--t1)}
.ftab.on{background:var(--brand);color:#fff;border-color:var(--brand)}
.ftab .cnt{font-size:10px;font-weight:700;background:rgba(255,255,255,0.1);padding:1px 6px;border-radius:6px}
.ftab.on .cnt{background:rgba(255,255,255,0.2)}
.search{flex:1;min-width:180px;padding:8px 14px;background:#fff;border:1px solid var(--border);border-radius:8px;color:var(--t1);font-size:13px;font-family:'DM Sans',sans-serif;outline:none;transition:.2s}
.search:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(30,58,95,0.06)}
.search::placeholder{color:var(--t3)}

/* ===== TABLE ===== */
.tbl{width:100%;border-collapse:separate;border-spacing:0}
.tbl thead th{font-size:10px;font-weight:700;color:var(--t3);text-transform:uppercase;letter-spacing:0.8px;padding:10px 14px;text-align:left;border-bottom:1px solid var(--border);position:sticky;top:56px;background:var(--bg);z-index:10}
.tbl tbody tr{cursor:pointer;transition:background .15s}
.tbl tbody tr:hover{background:#F1F3F7}
.tbl tbody tr.open{background:#F1F3F7}
.tbl td{padding:12px 14px;border-bottom:1px solid var(--border);font-size:13px;color:var(--t2);vertical-align:middle}
.tbl .name{font-weight:700;color:var(--t1)}
.tbl .ref{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--t3);letter-spacing:0.5px}
.badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:20px;font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.3px}
.b-review{background:var(--amber-bg);color:var(--amber)}.b-approved{background:var(--green-bg);color:var(--green)}.b-rejected{background:var(--red-bg);color:var(--red)}
.b-dot{width:5px;height:5px;border-radius:50%;background:currentColor}
.arrow{color:var(--t3);transition:transform .2s}
tr.open .arrow{transform:rotate(180deg);color:var(--brand)}

/* ===== DETAIL ROW ===== */
.det-row{display:none}
.det-row.show{display:table-row}
.det-cell{padding:0 14px 16px;background:#F1F3F7;border-bottom:1px solid var(--border)}
.det-inner{padding:16px;border-radius:10px;background:#fff;border:1px solid var(--border);animation:detIn .2s ease;box-shadow:0 1px 4px rgba(0,0,0,0.04)}
@keyframes detIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
.d-sec{margin-bottom:14px}
.d-sec:last-child{margin-bottom:0}
.d-sec-title{font-size:10px;font-weight:700;color:var(--brand);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.d-grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:4px 16px}
.d-item{font-size:12px;padding:4px 0}
.d-item label{color:var(--t3);font-weight:600;display:block;margin-bottom:1px;font-size:10px;text-transform:uppercase;letter-spacing:0.5px}
.d-item span{color:var(--t2);font-weight:500}
.d-item a{color:var(--brand);text-decoration:none;font-weight:600;font-size:11px}
.d-item a:hover{text-decoration:underline}
.d-actions{display:flex;gap:8px;margin-top:14px;padding-top:12px;border-top:1px solid var(--border);flex-wrap:wrap;align-items:center}
.d-btn{padding:8px 16px;border-radius:8px;font-size:11px;font-weight:700;cursor:pointer;border:none;font-family:'DM Sans',sans-serif;transition:.15s;text-transform:uppercase;letter-spacing:0.5px}
.d-btn:hover{transform:translateY(-1px)}
.d-approve{background:var(--green);color:#fff}.d-reject{background:var(--red);color:#fff}.d-review{background:var(--amber);color:#fff}
.d-remarks{flex:1;min-width:140px;padding:8px 12px;background:#F7F8FB;border:1px solid var(--border);border-radius:8px;color:var(--t1);font-size:12px;font-family:'DM Sans',sans-serif;outline:none}
.d-remarks:focus{border-color:var(--brand)}
.d-remarks::placeholder{color:var(--t3)}

/* ===== TOAST ===== */
.toast{position:fixed;bottom:24px;right:24px;padding:12px 20px;background:#1E3A5F;border:none;color:#fff;border-radius:10px;font-size:13px;font-weight:600;z-index:999;box-shadow:0 12px 40px rgba(0,0,0,0.2);animation:toastIn .3s ease;display:flex;align-items:center;gap:8px}
.toast svg{width:16px;height:16px;flex-shrink:0}
@keyframes toastIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.empty{text-align:center;padding:60px 20px;color:var(--t3);font-size:14px}
.loading{text-align:center;padding:48px;color:var(--t3);font-size:13px}
.spin{display:inline-block;width:20px;height:20px;border:2px solid var(--border2);border-top-color:var(--brand);border-radius:50%;animation:spin .6s linear infinite;margin-bottom:8px}
@keyframes spin{to{transform:rotate(360deg)}}
.wrap{max-width:1200px;margin:0 auto;padding:20px 20px}

@media(max-width:768px){
  .stats{grid-template-columns:1fr 1fr}.d-grid{grid-template-columns:1fr 1fr}
  .tbl thead{display:none}
  .tbl,tbody,tr,td{display:block;width:100%}
  .tbl tbody tr{background:#fff;border:1px solid var(--border);border-radius:var(--r);margin-bottom:8px;padding:4px}
  .tbl td{border:none;padding:6px 14px;font-size:12px}
  .tbl td:first-child{padding-top:12px}.tbl td:last-child{padding-bottom:12px}
  .det-cell{border:none;border-radius:0 0 var(--r) var(--r)}
}
@media(max-width:480px){.stats{grid-template-columns:1fr}.d-grid{grid-template-columns:1fr}.d-actions{flex-direction:column}.d-remarks{width:100%}.bar{flex-direction:column}.search{min-width:100%}}
</style>
</head>
<body>
<div id="loginScreen" class="login-wrap">
  <div class="login-bg"></div>
  <div class="login-box">
    <div class="login-logo">âš¡ FLARIZE<span>.</span></div>
    <div class="login-sub">Partner Admin Console</div>
    <div class="login-fld"><label>Username</label><input type="text" id="inpUser" placeholder="admin" autofocus></div>
    <div class="login-fld"><label>Password</label><input type="password" id="inpPwd" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"></div>
    <button class="login-btn" onclick="login()">Login â†’</button>
    <div class="login-err" id="loginErr">Invalid credentials</div>
  </div>
</div>

<div id="dashScreen" style="display:none">
  <div class="topbar">
    <div class="topbar-left"><div class="topbar-logo">âš¡ FLARIZE<span>.</span></div><div class="topbar-badge">Dashboard</div></div>
    <div class="topbar-right">
      <button class="tb-btn" onclick="loadData()"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/></svg>Refresh</button>
      <button class="tb-btn logout" onclick="logout()">Logout</button>
    </div>
  </div>
  <div class="wrap">
    <div class="stats">
      <div class="stat"><div class="stat-label">Total Applications</div><div class="stat-val" id="sTotal">0</div></div>
      <div class="stat"><div class="stat-label">Under Review</div><div class="stat-val" id="sPending">0</div></div>
      <div class="stat"><div class="stat-label">Approved</div><div class="stat-val" id="sApproved">0</div></div>
      <div class="stat"><div class="stat-label">Rejected</div><div class="stat-val" id="sRejected">0</div></div>
    </div>
    <div class="bar">
      <div class="ftab on" data-f="all" onclick="setFilter('all')">All <span class="cnt" id="cAll">0</span></div>
      <div class="ftab" data-f="Under Review" onclick="setFilter('Under Review')">Review <span class="cnt" id="cReview">0</span></div>
      <div class="ftab" data-f="Approved" onclick="setFilter('Approved')">Approved <span class="cnt" id="cApproved">0</span></div>
      <div class="ftab" data-f="Rejected" onclick="setFilter('Rejected')">Rejected <span class="cnt" id="cRejected">0</span></div>
      <input class="search" placeholder="Search name, mobile, ref, district..." oninput="doSearch(this.value)">
    </div>
    <div id="tableWrap">
      <table class="tbl"><thead><tr><th>Applicant</th><th>Reference</th><th>District</th><th>Type</th><th>Date</th><th>Status</th><th></th></tr></thead><tbody id="tBody"><tr><td colspan="7"><div class="loading"><div class="spin"></div><br>Loading...</div></td></tr></tbody></table>
    </div>
  </div>
</div>

<script>
const API='https://script.google.com/macros/s/AKfycbyodXULxZ5PC4316pSU5380_U79_Ibh75Pyya35zZ_bh-Xs-2GUiU0pXlqP_5fKqqsI4Q/exec';
const ADMIN_USER='admin',ADMIN_PWD='Flarize@2025';
let AUTH='',ALL=[],curF='all',sq='',openIdx=-1;

document.getElementById('inpPwd').addEventListener('keydown',e=>{if(e.key==='Enter')login()});
document.getElementById('inpUser').addEventListener('keydown',e=>{if(e.key==='Enter')document.getElementById('inpPwd').focus()});

function login(){
  const u=document.getElementById('inpUser').value.trim(),p=document.getElementById('inpPwd').value;
  if(u!==ADMIN_USER||p!==ADMIN_PWD){document.getElementById('loginErr').style.display='block';return}
  AUTH=p;document.getElementById('loginErr').style.display='none';
  document.getElementById('loginScreen').style.display='none';
  document.getElementById('dashScreen').style.display='block';loadData();
}
function logout(){AUTH='';ALL=[];document.getElementById('dashScreen').style.display='none';document.getElementById('loginScreen').style.display='flex';document.getElementById('inpPwd').value=''}

async function loadData(){
  document.getElementById('tBody').innerHTML='<tr><td colspan="7"><div class="loading"><div class="spin"></div><br>Loading...</div></td></tr>';
  try{
    const r=await fetch(API+'?action=list&pin='+encodeURIComponent(AUTH));const d=await r.json();
    if(!d.success){if(d.error==='Invalid credentials'){logout();toast('Session expired','red')}return}
    ALL=d.data||[];updateStats();render();toast('Loaded '+ALL.length+' applications','green');
  }catch(e){document.getElementById('tBody').innerHTML='<tr><td colspan="7"><div class="empty">Connection failed</div></td></tr>'}
}

function updateStats(){
  const rev=ALL.filter(a=>(a.status||'Under Review')==='Under Review').length;
  const app=ALL.filter(a=>a.status==='Approved').length;
  const rej=ALL.filter(a=>a.status==='Rejected').length;
  document.getElementById('sTotal').textContent=ALL.length;
  document.getElementById('sPending').textContent=rev;
  document.getElementById('sApproved').textContent=app;
  document.getElementById('sRejected').textContent=rej;
  document.getElementById('cAll').textContent=ALL.length;
  document.getElementById('cReview').textContent=rev;
  document.getElementById('cApproved').textContent=app;
  document.getElementById('cRejected').textContent=rej;
}
function setFilter(f){curF=f;document.querySelectorAll('.ftab').forEach(el=>el.classList.toggle('on',el.dataset.f===f));render()}
function doSearch(v){sq=v.toLowerCase();render()}

function filtered(){
  return ALL.filter(a=>{
    const st=a.status||'Under Review';
    if(curF!=='all'&&st!==curF)return false;
    if(sq){const h=(a.full_name+' '+a.mobile+' '+a.reference_id+' '+a.email+' '+a.district).toLowerCase();if(!h.includes(sq))return false}
    return true;
  });
}
function bc(s){if(!s||s==='Under Review')return 'b-review';if(s==='Approved')return 'b-approved';return 'b-rejected'}
function fl(url){if(!url)return '<span style="color:var(--t3)">â€”</span>';return url.split(' , ').map((u,i)=>`<a href="${u.trim()}" target="_blank">ðŸ“Ž File ${i+1}</a>`).join(' ')}

function render(){
  const list=filtered();openIdx=-1;
  if(!list.length){document.getElementById('tBody').innerHTML='<tr><td colspan="7"><div class="empty">No applications found</div></td></tr>';return}
  let html='';
  list.forEach((a,i)=>{
    const st=a.status||'Under Review';
    const dt=a.submitted_at?new Date(a.submitted_at).toLocaleDateString('en-IN',{day:'numeric',month:'short'}):'â€”';
    html+=`<tr onclick="toggle(${i})" id="r${i}"><td class="name">${esc(a.full_name||'â€”')}</td><td class="ref">${esc(a.reference_id||'')}</td><td>${esc(a.district||'â€”')}</td><td>${esc(a.affiliate_type||'â€”')}</td><td>${dt}</td><td><span class="badge ${bc(st)}"><span class="b-dot"></span>${esc(st)}</span></td><td><svg class="arrow" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 9l6 6 6-6"/></svg></td></tr>`;
    html+=`<tr class="det-row" id="d${i}"><td class="det-cell" colspan="7"><div class="det-inner">
      <div class="d-sec"><div class="d-sec-title">Personal</div><div class="d-grid">
        <div class="d-item"><label>Mobile</label><span><a href="tel:${esc(a.mobile||'')}">${esc(a.mobile||'â€”')}</a></span></div>
        <div class="d-item"><label>Email</label><span>${esc(a.email||'â€”')}</span></div>
        <div class="d-item"><label>DOB / Gender</label><span>${esc(a.dob||'â€”')} Â· ${esc(a.gender||'â€”')}</span></div>
      </div></div>
      <div class="d-sec"><div class="d-sec-title">Address</div><div class="d-grid">
        <div class="d-item" style="grid-column:1/-1"><label>Full Address</label><span>${esc((a.address_1||'')+', '+(a.address_2||'')+', '+(a.city||'')+' - '+(a.pincode||''))}</span></div>
      </div></div>
      <div class="d-sec"><div class="d-sec-title">Business</div><div class="d-grid">
        <div class="d-item"><label>Company</label><span>${esc(a.company_name||'â€”')}</span></div>
        <div class="d-item"><label>Experience</label><span>${esc(a.experience||'â€”')}</span></div>
        <div class="d-item"><label>Leads/Mo</label><span>${esc(a.expected_leads||'â€”')}</span></div>
        <div class="d-item" style="grid-column:1/-1"><label>Service Areas</label><span>${esc(a.service_locations||'â€”')}</span></div>
      </div></div>
      <div class="d-sec"><div class="d-sec-title">Bank & KYC</div><div class="d-grid">
        <div class="d-item"><label>Bank</label><span>${esc(a.bank_name||'â€”')} Â· ${esc(a.ifsc||'')}</span></div>
        <div class="d-item"><label>Account</label><span>${esc(a.account_number||'â€”')}</span></div>
        <div class="d-item"><label>Aadhaar</label><span>${esc(a.aadhaar_number||'â€”')}</span></div>
        <div class="d-item"><label>PAN</label><span>${esc(a.pan_number||'â€”')}</span></div>
        <div class="d-item"><label>Documents</label><span>${fl(a.profile_photo_link)} ${fl(a.cancelled_cheque_link)} ${fl(a.aadhaar_link)} ${fl(a.pan_link)} ${fl(a.additional_id_link)}</span></div>
      </div></div>
      ${a.remarks?`<div class="d-sec"><div class="d-sec-title">Remarks</div><div style="font-size:12px;color:var(--t2);padding:8px 12px;background:var(--bg);border-radius:8px;border-left:3px solid ${st==='Approved'?'var(--green)':st==='Rejected'?'var(--red)':'var(--amber)'}">${esc(a.remarks)}</div></div>`:''}
      <div class="d-actions" onclick="event.stopPropagation()">
        <button class="d-btn d-approve" onclick="doUpdate(${i},'Approved')">âœ“ Approve</button>
        <button class="d-btn d-reject" onclick="doUpdate(${i},'Rejected')">âœ• Reject</button>
        <button class="d-btn d-review" onclick="doUpdate(${i},'Under Review')">â†» Review</button>
        <input class="d-remarks" id="rem${i}" placeholder="Add remarks..." value="${esc(a.remarks||'')}" onclick="event.stopPropagation()">
      </div>
    </div></td></tr>`;
  });
  document.getElementById('tBody').innerHTML=html;
}

function toggle(i){
  const d=document.getElementById('d'+i),r=document.getElementById('r'+i);
  const wasOpen=d.classList.contains('show');
  document.querySelectorAll('.det-row.show').forEach(el=>el.classList.remove('show'));
  document.querySelectorAll('tr.open').forEach(el=>el.classList.remove('open'));
  if(!wasOpen){d.classList.add('show');r.classList.add('open');openIdx=i}else{openIdx=-1}
}

async function doUpdate(i,status){
  const list=filtered(),a=list[i],remarks=document.getElementById('rem'+i)?.value||'',ref=a.reference_id;
  try{
    const r=await fetch(API+'?action=update&pin='+encodeURIComponent(AUTH)+'&ref='+encodeURIComponent(ref)+'&status='+encodeURIComponent(status)+'&remarks='+encodeURIComponent(remarks));
    const d=await r.json();
    if(d.success){
      const orig=ALL.find(x=>x.reference_id===ref);
      if(orig){orig.status=status;if(remarks)orig.remarks=remarks}
      updateStats();render();toast(ref+' â†’ '+status,'green');
    }else{toast('Error: '+(d.error||'Failed'),'red')}
  }catch(e){toast('Network error','red')}
}

function toast(msg,c){
  const t=document.createElement('div');t.className='toast';
  const svg=c==='green'?'<svg viewBox="0 0 24 24" fill="none" stroke="#22C55E" stroke-width="2.5"><path d="M20 6L9 17l-5-5"/></svg>':'<svg viewBox="0 0 24 24" fill="none" stroke="#EF4444" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/></svg>';
  t.innerHTML=svg+msg;document.body.appendChild(t);
  setTimeout(()=>{t.style.opacity='0';t.style.transition='opacity .3s';setTimeout(()=>t.remove(),300)},3000);
}
function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;')}
</script>
</body>
</html>
